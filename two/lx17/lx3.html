<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
  <!-- 瀑布流 -->
  <script src="../gg/base.js"></script>
  <style>
    *{
      margin: 0;
      padding: 0;
    }
    img{
      border: 0;
      width: 100%;
    }
    #box{
      margin: 0 auto;
      position: relative;
    }
    .item{
      width: 210px;
      box-shadow: 2px 2px 2px #ccc;
      position: absolute;
      overflow: hidden;
    }
    #box div:hover img{
      opacity: .8;
      transform: scale(1.5);
    }
  </style>
</head>
<body>
  <div id="box">
    <div class="item"><img src="images/59.jpg"></div>
    <div class="item"><img src="images/58.jpg"></div>
    <div class="item"><img src="images/57.jpg"></div>
    <div class="item"><img src="images/56.jpg"></div>
    <div class="item"><img src="images/55.jpg"></div>
    <div class="item"><img src="images/54.jpg"></div>
    <div class="item"><img src="images/53.jpg"></div>
    <div class="item"><img src="images/52.jpg"></div>
    <div class="item"><img src="images/51.jpg"></div>
    <div class="item"><img src="images/50.jpg"></div>
    <div class="item"><img src="images/49.jpg"></div>
    <div class="item"><img src="images/48.jpg"></div>
    <div class="item"><img src="images/47.jpg"></div>
    <div class="item"><img src="images/46.jpg"></div>
    <div class="item"><img src="images/45.jpg"></div>
    <div class="item"><img src="images/44.jpg"></div>
    <div class="item"><img src="images/43.jpg"></div>
  </div>
  <script>
    window.onload = function(){
      // window.onresize = function(){
        let box = document.querySelector('#box'),
            items = box.children,
            itemWidth = items[0].offsetWidth,
            gap = 10;
        var cols = parseInt(myTool.getBodySize().width/(itemWidth+gap))
        myTool.css(box, {
          width: cols*itemWidth+(cols-1)*gap + 'px'
        })
        var arr = Array(cols);
        for( var i =0 ; i<items.length; i++){
          if(i < cols){
            myTool.css(items[i], {
              top: '0px',
              left: i*(itemWidth+gap) + 'px'
            })
            arr[i] = items[i].offsetHeight+gap
          }else{
            for(j = 0, minIndex=0 ; j<arr.length; j++){
              if(arr[j] < arr[minIndex]) minIndex = j
            }
            myTool.css(items[i], {
              left: minIndex*(itemWidth+gap) + 'px',
              top: arr[minIndex] + 'px'
            })
            arr[minIndex] += items[i].offsetHeight + gap
          }
        }
        window.onscroll = function(){
          var scrollTop = document.documentElement.scrollTop || document.body.scrollTop
          // console.log(scrollTop)
          if(scrollTop >= items[items.length-1].offsetTop + items[items.length-1].offsetHeight - myTool.getBodySize().height-300){
            console.log('end')
            setTimeout(() => {
              // var datas = [
              //   "images/01.jpg",
              //   "images/02.jpg",
              //   "images/03.jpg",
              //   "images/04.jpg",
              //   "images/05.jpg",
              //   "images/06.jpg",
              //   "images/07.jpg",
              //   "images/08.jpg",
              //   "images/09.jpg",
              //   "images/10.jpg",
              //   "images/11.jpg",
              //   "images/12.jpg",
              //   "images/13.jpg",
              //   "images/14.jpg",
              //   "images/15.jpg",
              //   "images/16.jpg",
              //   "images/17.jpg",
              //   'images1/1.jpg',
              //   'images1/2.jpg',
              //   'images1/3.jpg',
              //   'images1/4.jpg',
              //   'images1/5.jpg',
              //   'images1/6.jpg',
              //   'images1/7.jpg',
              //   'images1/8.jpg',
              //   'images1/9.jpg',
              //   'images1/10.jpg',
              //   'images1/11.jpg',
              //   'images1/12.jpg',
              //   'images1/13.jpg',
              //   'images1/14.jpg',
              //   'images1/15.jpg',
              //   'images1/16.jpg',
              //   'images1/17.jpg',
              //   'images1/18.jpg',
              //   'images1/19.jpg',
              //   'images1/20.jpg',
              //   'images1/21.jpg',
              //   'images1/22.jpg',
              //   'images1/23.jpg',
              //   'images1/24.jpg',
              //   'images1/25.jpg',
              //   'images1/26.jpg',
              //   'images1/27.jpg',
              //   'images1/28.jpg',
              //   'images1/29.jpg',
              //   'images1/30.jpg',
              //   'images1/31.jpg',
              //   'images1/32.jpg',
              //   'images1/33.jpg',
              //   'images1/34.jpg',
              //   'images1/35.jpg',
              //   'images1/36.jpg',
              //   'images1/37.jpg',
              // ];
              // datas.forEach((data) => {
              //   var item = document.createElement('div')
              //   item.className = 'item'
              //   item.innerHTML = `<img src="${data}">`
              // })
              for(k =0 ;k<35 ;k++){
                var item = document.createElement('div')
                item.className = 'item'
                item.innerHTML = `<img src="images/${myTool.randomNum(1,59)}.jpg">`
                box.appendChild(item)
              }
              let items = box.children
              for( var i =0 ; i<items.length; i++){
          if(i < cols){
            myTool.css(items[i], {
              top: '0px',
              left: i*(itemWidth+gap) + 'px'
            })
            arr[i] = items[i].offsetHeight+gap
          }else{
            for(j = 0, minIndex=0 ; j<arr.length; j++){
              if(arr[j] < arr[minIndex]) minIndex = j
            }
            myTool.css(items[i], {
              left: minIndex*(itemWidth+gap) + 'px',
              top: arr[minIndex] + 'px'
            })
            arr[minIndex] += items[i].offsetHeight + gap
          }
        }
            },1)
          }
        }
      }
    // }
  </script>
</body>
</html>